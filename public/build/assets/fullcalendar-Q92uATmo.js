import{E as f,C as T,i as S,a as E,b as P,c as I}from"./index-CGyvkwR3.js";import{h as g}from"./moment-C5S46NFB.js";import{s as l}from"./swal-Bt6ici_8.js";import{n as s}from"./notyf-D_y3dwLD.js";import"./jquery-CP0fMIbo.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./sweetalert2.all-B9kxGEux.js";import"./notyf.min-DaJKEBVE.js";let O=$("#calendar").data("fullcalendar_workouts_visible"),N=$("#calendar").data("fullcalendar_workouts_locked"),B=$("#calendar").data("fullcalendar_rest_periods"),k=$("#calendar").data("update_workout_route"),R=$("#calendar").data("update_rest_period_route"),D=$("#calendar").data("delete_rest_period_route"),d=$("#calendar").data("is_administrator");$("#calendar").data("user_id");let i=document.querySelectorAll(".draggable"),x=document.querySelector(".draggable-container"),m=document.querySelector(".draggable-container .no-draggable");document.addEventListener("DOMContentLoaded",function(){let e=O.map(function(r){return{title:"#"+r.id+" - "+r.user.lastname+" "+r.user.firstname,start:r.date,userId:r.user_id,workoutId:r.id,type:"workout",color:p(r.status,r.date),className:""}}),t=N.map(function(r){return{title:"#"+r.id,start:r.date,userId:r.user_id,workoutId:r.id,type:"workout",color:p(r.status,r.date),className:"fc-not-allowed-workout"}}),n=B.map(function(r){return{title:"Période de repos",start:r.start_date,end:r.end_date,id:r.id,type:"rest_period",color:"var(--bs-danger)",rendering:"background",className:d?"":"fc-not-allowed-rest-period"}}),a=e.concat(t).concat(n);i&&i.length>0&&i.forEach(function(r){new f(r,{eventData:function(o){return{title:"#"+o.dataset.workout+" - "+o.dataset.title,originalParent:o.parentElement,userId:o.dataset.user,workoutId:o.dataset.workout,type:"workout",color:"var(--bs-secondary)"}}})});var u=document.getElementById("calendar"),y=new T(u,{plugins:[S,E,P,I],headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},initialView:"timeGridWeek",locale:"fr",timeZone:"Europe/Paris",businessHours:{daysOfWeek:[1,2,3,4,5,6,7],startTime:"10:00",endTime:"19:00"},allDaySlot:!1,eventResizableFromStart:!1,eventDurationEditable:!1,editable:!0,droppable:!0,slotMinTime:"10:00",slotMaxTime:"19:00",events:a,eventOverlap:!1,eventReceive:function(r){l.fire({title:"Ajouter l'entraînement ?",text:"Voulez-vous vraiment ajouter cet entraînement à votre planning ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non",focusConfirm:!0,focusCancel:!1}).then(o=>{o.isConfirmed?(console.log("Dropped !"),h(r)):(console.log("Drop annulé !"),r.revert())})},eventChange:function(r){const o=r.oldEvent.start,w=r.event.start,v=r.oldEvent.end,b=r.event.end;(o.getTime()!==w.getTime()||v&&b&&v.getTime()!==b.getTime())&&(r.event.extendedProps.type==="rest_period"?d?l.fire({title:"Modifier la période de repos ?",text:"Voulez-vous vraiment modifier cette période de repos sur votre planning ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non",focusConfirm:!0,focusCancel:!1}).then(c=>{c.isConfirmed?W(r):(console.log("Changement annulé !"),r.revert())}):(s.error("Vous n'êtes pas autorisé à modifier une période de repos !"),r.revert()):l.fire({title:"Modifier l'entraînement ?",text:"Voulez-vous vraiment modifier cet entraînement sur votre planning ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non",focusConfirm:!0,focusCancel:!1}).then(c=>{c.isConfirmed?h(r):(console.log("Changement annulé !"),r.revert())}))},eventClick:function(r){r.event.extendedProps.type==="rest_period"?d?l.fire({title:"Supprimer la période de repos ?",text:"Voulez-vous vraiment supprimer la période de repose de votre planning ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non",focusConfirm:!0,focusCancel:!1}).then(o=>{o.isConfirmed?(console.log("Event clicked !"),A(r)):console.log("Click annulé !")}):s.error("Vous n'êtes pas autorisé à supprimer une période de repos !"):l.fire({title:"Entraînement "+r.event.title,text:"Voulez-vous vraiment retirer cet entraînement de votre planning ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui",cancelButtonText:"Non",focusConfirm:!0,focusCancel:!1}).then(o=>{o.isConfirmed?(console.log("Event clicked !"),U(r)):console.log("Click annulé !")})}});y.render(),new f(i)});function C(){Array.from(x.children).filter(function(t){return t!==m}).length===0?m.style.display="flex":m.style.display="none"}function M(e){var t=e.event,n=document.createElement("li");n.className="draggable list-group border border-primary p-2",n.style.borderRadius="0",n.style.cursor="move",n.dataset.user=t.extendedProps.userId,n.dataset.workout=t.extendedProps.workoutId,n.dataset.title=t.title,n.innerHTML="Séance "+t.title,x.appendChild(n),new f(n,{eventData:{title:t.title,userId:t.extendedProps.userId,workoutId:t.extendedProps.workoutId}})}function h(e){let t=e.event.startStr,n=!1;t.length===10&&(t=t+"T10:00:00",n=!0),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:k,data:{userId:e.event.extendedProps.userId,workoutId:e.event.extendedProps.workoutId,date:t},success:function(a){switch(n&&window.location.reload(),a.status){case"success":s.success(a.message),e.draggedEl!=null&&e.draggedEl.remove(),_(a.workout),console.log("Workout.status : ",a.workout.status),console.log("Workout.date : ",a.workout.date),e.event.setProp("color",p(a.workout.status,a.workout.date));break;case"error":s.error(a.message??"Une erreur est survenue !"),e.revert();break;default:s.error("Une erreur est survenue !"),e.revert();break}},error:function(a){s.error(a.responseJSON.message??"Une erreur est survenue !"),e.revert()}}).always(function(){C()})}function U(e){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:k,data:{userId:e.event.extendedProps.userId,workoutId:e.event.extendedProps.workoutId},success:function(t){switch(t.status){case"success":s.success(t.message),e.event.remove(),M(e),_(t.workout);break;case"error":s.error(t.message??"Une erreur est survenue !");break;default:s.error("Une erreur est survenue !");break}},error:function(t){console.log(t),s.error(t.responseJSON.message??"Une erreur est survenue !")}}).always(function(){C()})}function W(e){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:R,data:{rest_period:e.event.id,start_date:e.event.startStr,end_date:e.event.endStr},success:function(t){switch(t.status){case"success":s.success(t.message);break;case"error":s.error(t.message??"Une erreur est survenue !"),e.revert();break;default:s.error("Une erreur est survenue !"),e.revert();break}},error:function(t){s.error(t.responseJSON.message??"Une erreur est survenue !"),e.revert()}})}function A(e){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},type:"POST",url:D,data:{rest_period:e.event.id,start_date:e.event.startStr,end_date:e.event.endStr},success:function(t){switch(t.status){case"success":s.success(t.message),e.event.remove();break;case"error":s.error(t.message??"Une erreur est survenue !");break;default:s.error("Une erreur est survenue !");break}},error:function(t){s.error(t.responseJSON.message??"Une erreur est survenue !")}})}function p(e,t){return new Date(t)<new Date?e==1?"var(--bs-success)":"var(--bs-warning)":"var(--bs-secondary)"}function _(e){if($(".datatable").length){var t=$(".datatable").DataTable(),n=t.row('tr[data-workout-id="'+e.id+'"]');if(n.length){var a=[];a.push("<strong>"+e.id+"</strong>"),a.push(V(e)),d&&a.push(z(e)),a.push(F(e)),a.push(j(e)),d&&a.push(L(e)),n.data(a).draw()}else s.error("L'entraînement #"+e.id+" n'a pas été trouvé dans le tableau, veuillez recharger la page !")}else s.error("La table .datatable n'existe pas !")}function V(e){return e.date?e.status==1?'<span class="badge bg-success"><span>Faite</span><i class="fas fa-check ms-2"></i></span>':'<span class="badge bg-warning"><span>Non faite</span><i class="fas fa-close ms-2"></i></span>':'<span class="badge bg-danger"><span>A planifier</span><i class="fas fa-exclamation-triangle ms-2"></i></span>'}function z(e){var t="/admin/members/edit/"+e.user.id,n=e.user.firstname+" "+e.user.lastname;return'<a href="'+t+'" class="text-decoration-underline">'+n+"</a>"}function F(e){return e.plan_id?'<span class="badge bg-primary">Abonnement</span>':`<span class="badge bg-secondary">A l'unité</span>`}function j(e){if(e.date){var t=g(e.date).format("DD/MM/YY - HH:mm");return t}else return'<span class="badge bg-danger"><span>A planifier</span><i class="fas fa-exclamation-triangle ms-2"></i></span>'}function L(e){var t='<div class="d-flex gap-2 align-items-center">',n="/admin/calendar/workouts/soft-delete/"+e.user.id+"/"+e.id;if(t+='<a href="'+n+'" class="btn btn-danger btn-sm warning-row" title="Supprimer la séance"><i class="fas fa-trash-alt"></i></a>',e.date&&g(e.date).isBefore(g()))if(e.status==1){var a="/admin/calendar/workouts/undone/"+e.user.id+"/"+e.id;t+='<a href="'+a+'" class="btn btn-warning btn-sm" title="Marquer comme non faite"><i class="fas fa-undo"></i></a>'}else{var u="/admin/calendar/workouts/done/"+e.user.id+"/"+e.id;t+='<a href="'+u+'" class="btn btn-success btn-sm" title="Marquer comme faite"><i class="fas fa-check"></i></a>'}return t+="</div>",t}
